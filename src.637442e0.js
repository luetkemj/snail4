parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"hr3N":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const E={WHITE_SMILING_FACE:"☺",BLACK_SMILING_FACE:"☻",BLACK_HEART_SUIT:"♥",BLACK_DIAMOND_SUIT:"♦",BLACK_CLUB_SUIT:"♣",BLACK_SPADE_SUIT:"♠",BULLET:"•",INVERSE_BULLET:"◘",WHITE_CIRCLE:"○",INVERSE_WHITE_CIRCLE:"◙",MALE_SIGN:"♂",FEMALE_SIGN:"♀",EIGHTH_NOTE:"♪",BEAMED_EIGHTH_NOTES:"♫",WHITE_SUN_WITH_RAYS:"☼",NULL:" ",SPACE:" ",AMPERSAND:"&",DOT:".",FULL_STOP:".",PLUS:"+",MINUS:"-",HASH:"#",DOLLAR:"$",PERCENT:"%",CARET:"^",ASTERISK:"*",TILDE:"~",LEFT_PARENS:"(",RIGHT_PARENS:")",LEFT_BRACKET:"[",RIGHT_BRACKET:"]",AT:"@"};var _=E;exports.default=_;
},{}],"xbxC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e=function(e,t,i){return{family:e||"monospace",weight:t||"normal",size:i||16,toCSS:function(){return this.weight+" "+this.size+"px "+this.family}}};var t=e;exports.default=t;
},{}],"SY82":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={BLACK:"#000",WHITE:"#fff"};var t=e;exports.default=t;
},{}],"mUXt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./char")),r=t(require("./color"));function t(e){return e&&e.__esModule?e:{default:e}}const o=function(t,o,u){return{char:t||e.default.NULL,color:o||r.default.WHITE,bgColor:u||r.default.BLACK}};var u=o;exports.default=u;
},{"./char":"hr3N","./color":"SY82"}],"s5ra":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./char")),r=t(require("./color"));function t(e){return e&&e.__esModule?e:{default:e}}const o=function(t,o,u){return{character:t||e.default.NULL,foregroundColor:o||r.default.WHITE,backgroundColor:u||r.default.BLACK}};o.blank=function(e){return o(!1,!1,e)};var u=o;exports.default=u;
},{"./char":"hr3N","./color":"SY82"}],"jvjG":[function(require,module,exports) {
"use strict";function e(e,t,l){const r=new Array(e);for(let s=0;s<e;s++){r[s]=new Array(t);for(let e=0;e<t;e++)r[s][e]=l}return r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t,l){this._width=t,this._height=l,this._renderedCells=e(t,l,null),this._updatedCells=e(t,l,null),this._dirty=!0}setCharacter(e,t,l){if(!(e<0)&&!(e>=this._width)&&!(t<0)&&!(t>=this._height)&&l)if(this._renderedCells[e][t].character!=l){const r=this._updatedCells[e][t].foregroundColor||this._renderedCells[e][t].foregroundColor,s=this._updatedCells[e][t].backgroundColor||this._renderedCells[e][t].backgroundColor;this._updatedCells[e][t]={character:l,foregroundColor:r,backgroundColor:s},this._dirty=!0}else this._updatedCells[e][t]=null}setCell(e,t,l){e<0||e>=this._width||t<0||t>=this._height||(this._renderedCells[e][t]!==l?(this._updatedCells[e][t]=l,this._dirty=!0):this._updatedCells[e][t]=null)}getCell(e,t){if(!(e<0||e>=this._width||t<0||t>=this._height))return this._updatedCells[e][t]||this._renderedCells[e][t]}render(e){if(!this._dirty)return;let t;for(let l=0;l<this._width;l++)for(let r=0;r<this._height;r++)null!=(t=this._updatedCells[l][r])&&(e(l,r,t),this._renderedCells[l][r]=t,this._updatedCells[l][r]=null)}}var l=t;exports.default=l;
},{}],"sDll":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=l(require("./char")),e=l(require("./font")),i=l(require("./glyph")),s=l(require("./cell")),h=l(require("./display-state"));function l(t){return t&&t.__esModule?t:{default:t}}const a={width:40,height:30,font:(0,e.default)(),emptyCell:(0,s.default)(),isResponsive:!1,forceSquare:!0};class n{constructor(t,e){const i=Object.assign(a,{...e});this._width=i.width,this._height=i.height,this._font=i.font,this._responsive=i.isResponsive,this._squared=i.forceSquare,this._emptyCell=i.emptyCell,this._canvas=t,this._context=this._canvas.getContext("2d"),this._context.font=this._font.toCSS(),this._ratio=window.devicePixelRatio||1,this._display=new h.default(this._width,this._height),this.resetLayout(),this.clear()}resetLayout(){if(this._responsive){this._canvas.style.width||(this._canvas.style.width=640),this._canvas.style.height||(this._canvas.style.height=480);const t=parseInt(this._canvas.style.width,10)*this._ratio,e=parseInt(this._canvas.style.height,10)*this._ratio;this._cellWidth=Math.floor(t/this._width),this._cellHeight=Math.floor(e/this._height),this._squared&&(this._cellWidth=this._cellHeight=Math.max(this._cellWidth,this._cellHeight)),this._canvas.width=t,this._canvas.height=e}else{const t=this._context.measureText("M");let e=Math.ceil(t.width),i=this._font.size;this._squared&&(e=i=Math.max(e,i)),this._cellWidth=e*this._ratio,this._cellHeight=i*this._ratio;const s=e*this._width,h=i*this._height;this._canvas.width=s*this._ratio,this._canvas.height=h*this._ratio,this._canvas.style.width=`${s}px`,this._canvas.style.height=`${h}px`}this._font.size=this._font.size*this._ratio,this._context.font=this._font.toCSS(),this._context.textAlign="center",this._context.textBaseline="middle"}get width(){return this._width}get height(){return this._height}clear(){this.fill(this._emptyCell)}fill(t){for(let e=0;e<this._width;e++)for(let i=0;i<this._height;i++)this._display.setCell(e,i,t)}readCell(t,e){return this._display.getCell(t,e)}writeCell(t,e,i){this._display.setCell(t,e,i)}writeCharacter(t,e,i){this._display.setCharacter(t,e,i)}render(){this._display.render((e,i,s)=>{const h=this._cellWidth,l=this._cellHeight;if(this._context.fillStyle=s.backgroundColor,this._context.fillRect(e*h,i*l,h,l),s.character==t.default.NULL)return;this._context.fillStyle=s.foregroundColor;const a=e*h+h/2,n=i*l+l/2;this._context.fillText(s.character,a,n)})}pxToCell(t){const e=this._canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top;return[Math.trunc(i/this._cellWidth*this._ratio),Math.trunc(s/this._cellHeight*this._ratio)]}onClick(t){this._canvas.addEventListener("click",e=>{const i=this.pxToCell(e);t(i[0],i[1])})}onMouseMove(t){this._canvas.addEventListener("mousemove",e=>{const i=this.pxToCell(e);t(i[0],i[1])})}}var o=n;exports.default=o;
},{"./char":"hr3N","./font":"xbxC","./glyph":"mUXt","./cell":"s5ra","./display-state":"jvjG"}],"kPD5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){var e=(+new Date).toString(16)+(1e8*Math.random()|0).toString(16),t={};return{id:e,components:t,addComponent:function(e){t[e.name]=e},removeComponent:function(e){delete t[e]},print:function(){console.log(JSON.stringify(this,null,2))}}},t=e;exports.default=t;
},{}],"Am5m":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.color,o=void 0===r?"#ff0077":r,t=e.char;return{name:"appearance",color:o,char:void 0===t?"?":t}},r=e;exports.default=r;
},{}],"XZmk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return{name:"playerControlled",playerControlled:!0}},t=e;exports.default=t;
},{}],"Nchl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.x,o=void 0===t?0:t,r=e.y;return{name:"position",x:o,y:void 0===r?0:r}},t=e;exports.default=t;
},{}],"TPMF":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("../ECS"));function t(e){return e&&e.__esModule?e:{default:e}}var a=function(t,a,o){var u=t.components.position,n=e.default.game.grid,r=n.width,i=n.height,d=Math.min(r-1,Math.max(0,u.x+a)),s=Math.min(i-1,Math.max(0,u.y+o));u.x=d,u.y=s},o=function(t){Object.keys(t).forEach(function(o){var u=t[o].components,n=u.position,r=u.playerControlled;if(n&&r&&e.default.game.userInput&&"MOVE"===e.default.game.userInput.type){var i=e.default.game.userInput.payload,d=i.x,s=i.y;a(t[o],d,s)}})},u=o;exports.default=u;
},{"../ECS":"j0S0"}],"ImJu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("../ECS")),r=t(require("overprint/overprint/cell"));function t(e){return e&&e.__esModule?e:{default:e}}var a=function(t){e.default.game.grid.clear(),Object.keys(t).forEach(function(a){var o=t[a].components,u=o.appearance,i=o.position;u&&i&&e.default.game.grid.writeCell(i.x,i.y,(0,r.default)(u.char,u.color))}),e.default.game.grid.render()},o=a;exports.default=o;
},{"../ECS":"j0S0","overprint/overprint/cell":"s5ra"}],"j0S0":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("overprint/overprint/text-grid")),t=a(require("overprint/overprint/font")),r=a(require("./Entity")),n=a(require("./components/appearance.component")),o=a(require("./components/player-controlled.component")),u=a(require("./components/position.component")),i=a(require("./systems/move.system")),s=a(require("./systems/render.system"));function a(e){return e&&e.__esModule?e:{default:e}}var l=document.querySelector("#game"),p=80,d=50,m=15,c={entities:{},components:{appearance:n.default,playerControlled:o.default,position:u.default},systems:[i.default,s.default],game:{userInput:null,playerTurn:!0,grid:new e.default(l,{width:p,height:d,font:(0,t.default)("Menlo",!1,m)})},Entity:r.default},f=c;exports.default=f;
},{"overprint/overprint/text-grid":"sDll","overprint/overprint/font":"xbxC","./Entity":"kPD5","./components/appearance.component":"Am5m","./components/player-controlled.component":"XZmk","./components/position.component":"Nchl","./systems/move.system":"TPMF","./systems/render.system":"ImJu"}],"xyAp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=t;var e=a(require("./ECS"));function a(e){return e&&e.__esModule?e:{default:e}}function t(a){switch(a){case"o":e.default.game.userInput={key:a,type:"TOGGLE_OMNISCIENCE",payload:{}};break;case"z":e.default.game.userInput={key:a,type:"REST",payload:{}};break;case"ArrowUp":e.default.game.userInput={key:a,type:"MOVE",payload:{x:0,y:-1}};break;case"ArrowDown":e.default.game.userInput={key:a,type:"MOVE",payload:{x:0,y:1}};break;case"ArrowLeft":e.default.game.userInput={key:a,type:"MOVE",payload:{x:-1,y:0}};break;case"ArrowRight":e.default.game.userInput={key:a,type:"MOVE",payload:{x:1,y:0}}}}
},{"./ECS":"j0S0"}],"Focm":[function(require,module,exports) {
"use strict";var e=n(require("./ECS/ECS")),t=n(require("./ECS/key-bindings"));function n(e){return e&&e.__esModule?e:{default:e}}var a=e.default.Entity();function u(){for(var t=0;t<e.default.systems.length;t++)e.default.systems[t](e.default.entities)}function r(){e.default.game.userInput&&e.default.game.playerTurn&&(u(),e.default.game.userInput=null,e.default.game.playerTurn=!1),e.default.game.playerTurn||(u(),e.default.game.playerTurn=!0)}function d(){r(),requestAnimationFrame(d)}a.addComponent(e.default.components.appearance({char:"@",color:"#daa520"})),a.addComponent(e.default.components.playerControlled()),a.addComponent(e.default.components.position()),a.print(),e.default.entities[a.id]=a,document.addEventListener("keydown",function(e){return(0,t.default)(e.key)}),u(),requestAnimationFrame(d);
},{"./ECS/ECS":"j0S0","./ECS/key-bindings":"xyAp"}]},{},["Focm"], null)
//# sourceMappingURL=/snail4/src.637442e0.js.map